<!-- Login Page -->
<div class="login-container">
  <div class="login-card animate-fade-in">
    <div class="login-header">
      <i class="fas fa-sign-in-alt login-icon"></i>
      <h2>Đăng nhập</h2>
      <p>Vui lòng nhập thông tin để tiếp tục</p>
    </div>

    <form action="/login" method="POST" class="login-form" id="loginForm">
      <!-- CSRF Token -->
      <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <% } %>

      <div class="form-group">
        <label for="email"> <i class="fas fa-envelope"></i> Email </label>
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="Nhập email của bạn"
          value="<%= typeof formData !== 'undefined' && formData ? formData.email : '' %>"
          class="form-input <%= typeof errors !== 'undefined' && errors && errors.find(e => e.param === 'email') ? 'error' : '' %>"
        />
        <% if (typeof errors !== 'undefined' && errors && errors.find(e =>
        e.param === 'email')) { %>
        <div class="error-message">
          <%= errors.find(e => e.param === 'email').msg %>
        </div>
        <% } %>
      </div>

      <div class="form-group">
        <label for="password"> <i class="fas fa-lock"></i> Mật khẩu </label>
        <div class="password-input-container">
          <input
            type="password"
            id="password"
            name="password"
            required
            placeholder="Nhập mật khẩu"
            class="form-input <%= typeof errors !== 'undefined' && errors && errors.find(e => e.param === 'password') ? 'error' : '' %>"
          />
          <button
            type="button"
            class="password-toggle"
            onclick="togglePassword()"
          >
            <i class="fas fa-eye" id="passwordIcon"></i>
          </button>
        </div>
        <% if (typeof errors !== 'undefined' && errors && errors.find(e =>
        e.param === 'password')) { %>
        <div class="error-message">
          <%= errors.find(e => e.param === 'password').msg %>
        </div>
        <% } %>
      </div>

      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" name="rememberMe" value="true" />
          <span class="checkmark"></span>
          Ghi nhớ đăng nhập
        </label>
      </div>

      <!-- General Errors -->
      <% if (typeof errors !== 'undefined' && errors && errors.find(e => e.param
      === 'general')) { %>
      <div class="alert alert-error">
        <%= errors.find(e => e.param === 'general').msg %>
      </div>
      <% } %>

      <button type="submit" class="btn btn-primary btn-login">
        <i class="fas fa-sign-in-alt"></i>
        Đăng nhập
      </button>
    </form>

    <div class="login-footer">
      <p>
        Chưa có tài khoản?
        <a href="/api/v1/signIn" class="register-link">Đăng ký ngay</a>
      </p>
      <p><a href="/forgot-password" class="forgot-link">Quên mật khẩu?</a></p>
    </div>

    <!-- Demo Credentials (chỉ hiển thị trong development) -->
    <% if (process.env.NODE_ENV === 'development') { %>
    <div class="demo-credentials">
      <h4>Demo Credentials:</h4>
      <p><strong>Admin:</strong> admin@example.com / Admin@123456</p>
      <p><strong>User:</strong> user@example.com / User@123456</p>
    </div>
    <% } %>
  </div>

  <!-- Background Animation -->
  <div class="login-bg">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
    </div>
  </div>
</div>

<script>
  // Password toggle functionality
  function togglePassword() {
    const passwordInput = document.getElementById("password");
    const passwordIcon = document.getElementById("passwordIcon");

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      passwordIcon.className = "fas fa-eye-slash";
    } else {
      passwordInput.type = "password";
      passwordIcon.className = "fas fa-eye";
    }
  }

  // Form validation
  document.getElementById("loginForm").addEventListener("submit", function (e) {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    let hasError = false;

    // Clear previous errors
    document.querySelectorAll(".error-message").forEach((el) => el.remove());
    document
      .querySelectorAll(".form-input")
      .forEach((el) => el.classList.remove("error"));

    // Validate email
    if (!email) {
      showFieldError("email", "Email là bắt buộc");
      hasError = true;
    } else if (!isValidEmail(email)) {
      showFieldError("email", "Email không hợp lệ");
      hasError = true;
    }

    // Validate password
    if (!password) {
      showFieldError("password", "Mật khẩu là bắt buộc");
      hasError = true;
    }

    if (hasError) {
      e.preventDefault();
    }
  });

  function showFieldError(fieldId, message) {
    const field = document.getElementById(fieldId);
    field.classList.add("error");

    const errorDiv = document.createElement("div");
    errorDiv.className = "error-message";
    errorDiv.textContent = message;

    field.parentNode.appendChild(errorDiv);
  }

  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Enter key support
  document.addEventListener("keydown", function (e) {
    if (e.key === "Enter" && document.activeElement.tagName !== "BUTTON") {
      document.getElementById("loginForm").dispatchEvent(new Event("submit"));
    }
  });

  // Auto-focus email field
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("email").focus();
  });
</script>
