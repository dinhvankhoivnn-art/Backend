# ğŸš€ Lá»™ trÃ¬nh há»c Backend vá»›i Express.js vÃ  Mongoose

## ğŸ“‹ Má»¥c lá»¥c

- [Giá»›i thiá»‡u](#giá»›i-thiá»‡u)
- [CÆ¡ báº£n vá» Backend Development](#cÆ¡-báº£n-vá»-backend-development)
- [CÃ i Ä‘áº·t mÃ´i trÆ°á»ng](#cÃ i-Ä‘áº·t-mÃ´i-trÆ°á»ng)
- [Node.js cÆ¡ báº£n](#nodejs-cÆ¡-báº£n)
- [Express.js chi tiáº¿t](#expressjs-chi-tiáº¿t)
- [Routing vÃ  Middleware](#routing-vÃ -middleware)
- [MongoDB vÃ  Mongoose](#mongodb-vÃ -mongoose)
- [Models vÃ  Schemas](#models-vÃ -schemas)
- [CRUD Operations](#crud-operations)
- [Authentication vÃ  Authorization](#authentication-vÃ -authorization)
- [Security Best Practices](#security-best-practices)
- [HTTP Status Codes](#http-status-codes)
- [Error Handling](#error-handling)
- [Testing](#testing)
- [Deployment](#deployment)
- [Advanced Topics](#advanced-topics)
- [Best Practices](#best-practices)
- [Resources](#resources)

## ğŸŒŸ Giá»›i thiá»‡u

ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i lá»™ trÃ¬nh há»c backend hoÃ n chá»‰nh sá»­ dá»¥ng Node.js, Express.js vÃ  Mongoose! ÄÃ¢y lÃ  hÆ°á»›ng dáº«n chi tiáº¿t tá»« cÆ¡ báº£n Ä‘áº¿n nÃ¢ng cao, giÃºp báº¡n xÃ¢y dá»±ng má»™t backend API máº¡nh máº½. ChÃºng ta sáº½ Ä‘i qua tá»«ng bÆ°á»›c má»™t cÃ¡ch rÃµ rÃ ng, vá»›i vÃ­ dá»¥ code, giáº£i thÃ­ch vÃ  máº¹o thá»±c táº¿. HÃ£y chuáº©n bá»‹ sáºµn sÃ ng Ä‘á»ƒ há»c há»i vÃ  thá»±c hÃ nh!

Backend development lÃ  viá»‡c xÃ¢y dá»±ng pháº§n "áº©n" cá»§a á»©ng dá»¥ng, xá»­ lÃ½ dá»¯ liá»‡u, logic nghiá»‡p vá»¥ vÃ  giao tiáº¿p vá»›i database. Vá»›i Express.js, báº¡n cÃ³ thá»ƒ táº¡o RESTful APIs nhanh chÃ³ng, vÃ  Mongoose giÃºp tÆ°Æ¡ng tÃ¡c vá»›i MongoDB dá»… dÃ ng.

**LÆ°u Ã½:** Báº¡n cáº§n kiáº¿n thá»©c cÆ¡ báº£n vá» JavaScript. Náº¿u chÆ°a, hÃ£y há»c ES6+ trÆ°á»›c.

## ğŸ”§ CÆ¡ báº£n vá» Backend Development

Backend lÃ  trÃ¡i tim cá»§a á»©ng dá»¥ng, xá»­ lÃ½:

- Xá»­ lÃ½ yÃªu cáº§u tá»« frontend (API endpoints).
- TÆ°Æ¡ng tÃ¡c vá»›i database (lÆ°u trá»¯, truy váº¥n dá»¯ liá»‡u).
- XÃ¡c thá»±c ngÆ°á»i dÃ¹ng, báº£o máº­t.
- Logic nghiá»‡p vá»¥ (vÃ­ dá»¥: tÃ­nh toÃ¡n, gá»­i email).

**So sÃ¡nh Frontend vs Backend:**

- Frontend: UI/UX, tÆ°Æ¡ng tÃ¡c ngÆ°á»i dÃ¹ng (HTML, CSS, JS).
- Backend: Logic, dá»¯ liá»‡u (Server-side).

**CÃ´ng nghá»‡ chÃ­nh trong lá»™ trÃ¬nh:**

- Node.js: Runtime cho JavaScript server-side.
- Express.js: Framework web cho Node.js.
- Mongoose: ODM cho MongoDB.
- MongoDB: NoSQL database.

## ğŸ’» CÃ i Ä‘áº·t mÃ´i trÆ°á»ng

TrÆ°á»›c khi báº¯t Ä‘áº§u, hÃ£y thiáº¿t láº­p mÃ´i trÆ°á»ng development.

### BÆ°á»›c 1: CÃ i Ä‘áº·t Node.js

- Táº£i tá»« nodejs.org hoáº·c sá»­ dá»¥ng NVM.
- Kiá»ƒm tra: `node -v` (nÃªn >= 14).
- npm Ä‘i kÃ¨m: `npm -v`.

### BÆ°á»›c 2: CÃ i Ä‘áº·t MongoDB

- CÃ i Ä‘áº·t cá»¥c bá»™: Tá»« mongodb.com.
- Hoáº·c sá»­ dá»¥ng MongoDB Atlas (cloud, miá»…n phÃ­).

### BÆ°á»›c 3: Editor vÃ  Tools

- Sá»­ dá»¥ng VS Code.
- CÃ i Ä‘áº·t Postman Ä‘á»ƒ test API.
- Git cho version control.

### BÆ°á»›c 4: Khá»Ÿi táº¡o dá»± Ã¡n

```
mkdir my-backend
cd my-backend
npm init -y
```

Cáº­p nháº­t package.json vá»›i scripts:

```json
{
  "scripts": {
    "start": "node app.js",
    "dev": "nodemon app.js"
  }
}
```

## ğŸŸ¢ Node.js cÆ¡ báº£n

Node.js cho phÃ©p cháº¡y JavaScript trÃªn server.

### Hello World

Táº¡o file app.js:

```javascript
console.log("Hello, Node.js!");
```

Cháº¡y: `node app.js`.

### Modules

Node.js sá»­ dá»¥ng CommonJS hoáº·c ES modules.

VÃ­ dá»¥ CommonJS:

```javascript
const fs = require("fs");
fs.readFile("file.txt", (err, data) => {
  if (err) throw err;
  console.log(data.toString());
});
```

ES Modules:

```javascript
import fs from "fs";
```

### HTTP Server cÆ¡ báº£n

```javascript
const http = require("http");

const server = http.createServer((req, res) => {
  res.writeHead(200, { "Content-Type": "text/plain" });
  res.end("Hello World!");
});

server.listen(3000, () => {
  console.log("Server running at http://localhost:3000/");
});
```

### NPM vÃ  Packages

NPM lÃ  quáº£n lÃ½ gÃ³i.

- `npm install package-name` Ä‘á»ƒ cÃ i Ä‘áº·t.
- `npm install --save-dev` cho dev dependencies.

VÃ­ dá»¥: CÃ i Express: `npm install express`.

## ğŸš€ Express.js chi tiáº¿t

Express.js lÃ  framework nháº¹ cho Node.js, giÃºp xÃ¢y dá»±ng web apps nhanh.

### CÃ i Ä‘áº·t Express

```
npm install express
```

### Hello World vá»›i Express

```javascript
const express = require("express");
const app = express();

app.get("/", (req, res) => {
  res.send("Hello World!");
});

app.listen(3000, () => {
  console.log("Server on port 3000");
});
```

### Request vÃ  Response

- `req`: Object chá»©a dá»¯ liá»‡u tá»« client (params, body, query).
- `res`: Object Ä‘á»ƒ gá»­i response (res.send(), res.json()).

VÃ­ dá»¥:

```javascript
app.get("/user/:id", (req, res) => {
  const userId = req.params.id;
  res.json({ userId });
});
```

### Middleware

Middleware lÃ  function cháº¡y giá»¯a request vÃ  response.

Built-in: `app.use(express.json())` Ä‘á»ƒ parse JSON.

Custom middleware:

```javascript
const logger = (req, res, next) => {
  console.log(`${req.method} ${req.url}`);
  next();
};

app.use(logger);
```

## ğŸ›£ï¸ Routing vÃ  Middleware

Routing Ä‘á»‹nh nghÄ©a cÃ¡ch xá»­ lÃ½ cÃ¡c endpoint.

### Basic Routes

```javascript
app.get("/users", (req, res) => {
  // Logic to get users
});

app.post("/users", (req, res) => {
  // Logic to create user
});
```

### Route Parameters

```javascript
app.get("/users/:id", (req, res) => {
  const id = req.params.id;
  // Fetch user by id
});
```

### Query Parameters

```javascript
app.get("/users", (req, res) => {
  const { name } = req.query;
  // Filter users by name
});
```

### Middleware nÃ¢ng cao

- CORS: `npm install cors`

```javascript
const cors = require("cors");
app.use(cors());
```

- Helmet: Báº£o máº­t headers.

```javascript
const helmet = require("helmet");
app.use(helmet());
```

## ğŸ—„ï¸ MongoDB vÃ  Mongoose

MongoDB lÃ  NoSQL database, lÆ°u dá»¯ liá»‡u dÆ°á»›i dáº¡ng JSON.

### Káº¿t ná»‘i MongoDB

Sá»­ dá»¥ng MongoDB Atlas hoáº·c local.

CÃ i Mongoose: `npm install mongoose`

```javascript
const mongoose = require("mongoose");

mongoose.connect("mongodb://localhost:27017/myapp", {
  useNewUrlParser: true,
  useUnifiedTopology: true,
});

const db = mongoose.connection;
db.on("error", console.error.bind(console, "connection error:"));
db.once("open", () => {
  console.log("Connected to MongoDB");
});
```

### Schemas vÃ  Models

Schema Ä‘á»‹nh nghÄ©a cáº¥u trÃºc dá»¯ liá»‡u.

```javascript
const userSchema = new mongoose.Schema({
  name: { type: String, required: true },
  email: { type: String, unique: true },
  age: Number,
});

const User = mongoose.model("User", userSchema);
```

### CRUD vá»›i Mongoose

- Create: `User.create({ name: 'John', email: 'john@example.com' });`
- Read: `User.find();`
- Update: `User.findByIdAndUpdate(id, { name: 'Jane' });`
- Delete: `User.findByIdAndDelete(id);`

## ğŸ“Š Models vÃ  Schemas chi tiáº¿t

Models lÃ  constructor dá»±a trÃªn schema.

### Validation

```javascript
const userSchema = new mongoose.Schema({
  name: {
    type: String,
    required: [true, "Name is required"],
    minlength: 2,
  },
  email: {
    type: String,
    required: true,
    unique: true,
    match: [/^\S+@\S+\.\S+$/, "Please enter a valid email"],
  },
});
```

### Virtuals vÃ  Methods

```javascript
userSchema.virtual("fullName").get(function () {
  return this.name;
});

userSchema.methods.getAge = function () {
  return this.age;
};
```

## ğŸ”„ CRUD Operations

Thá»±c hÃ nh CRUD vá»›i Express vÃ  Mongoose.

### Setup Routes

Táº¡o file routes/users.js:

```javascript
const express = require("express");
const router = express.Router();
const User = require("../models/User");

// Get all users
router.get("/", async (req, res) => {
  try {
    const users = await User.find();
    res.json(users);
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});

// Create user
router.post("/", async (req, res) => {
  const user = new User(req.body);
  try {
    const newUser = await user.save();
    res.status(201).json(newUser);
  } catch (err) {
    res.status(400).json({ message: err.message });
  }
});

module.exports = router;
```

Káº¿t ná»‘i trong app.js:

```javascript
const userRoutes = require("./routes/users");
app.use("/api/users", userRoutes);
```

### Update vÃ  Delete

```javascript
// Update
router.put("/:id", async (req, res) => {
  try {
    const updatedUser = await User.findByIdAndUpdate(req.params.id, req.body, {
      new: true,
    });
    res.json(updatedUser);
  } catch (err) {
    res.status(400).json({ message: err.message });
  }
});

// Delete
router.delete("/:id", async (req, res) => {
  try {
    await User.findByIdAndDelete(req.params.id);
    res.json({ message: "User deleted" });
  } catch (err) {
    res.status(500).json({ message: err.message });
  }
});
```

## ğŸ” Authentication vÃ  Authorization

Báº£o máº­t API vá»›i JWT.

CÃ i: `npm install jsonwebtoken bcryptjs`

### Register vÃ  Login

Model User:

```javascript
const userSchema = new mongoose.Schema({
  username: String,
  password: String,
});

userSchema.pre("save", async function (next) {
  if (this.isModified("password")) {
    this.password = await bcrypt.hash(this.password, 10);
  }
  next();
});
```

Routes:

```javascript
const jwt = require("jsonwebtoken");
const bcrypt = require("bcryptjs");

// Register
app.post("/register", async (req, res) => {
  const { username, password } = req.body;
  const user = new User({ username, password });
  await user.save();
  res.status(201).json({ message: "User registered" });
});

// Login
app.post("/login", async (req, res) => {
  const { username, password } = req.body;
  const user = await User.findOne({ username });
  if (user && (await bcrypt.compare(password, user.password))) {
    const token = jwt.sign({ id: user._id }, "secret");
    res.json({ token });
  } else {
    res.status(401).json({ message: "Invalid credentials" });
  }
});
```

### Middleware Auth

```javascript
const auth = (req, res, next) => {
  const token = req.header("Authorization");
  if (!token) return res.status(401).json({ message: "Access denied" });
  try {
    const verified = jwt.verify(token, "secret");
    req.user = verified;
    next();
  } catch (err) {
    res.status(400).json({ message: "Invalid token" });
  }
};

app.get("/protected", auth, (req, res) => {
  res.json({ message: "Protected route" });
});
```

## ğŸ›¡ï¸ Security Best Practices

- Sá»­ dá»¥ng HTTPS.
- Validate input: `npm install express-validator`

```javascript
const { body, validationResult } = require("express-validator");

app.post(
  "/users",
  [body("email").isEmail(), body("password").isLength({ min: 5 })],
  (req, res) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({ errors: errors.array() });
    }
    // Proceed
  }
);
```

- Rate limiting: `npm install express-rate-limit`
- Sanitize data.

## ğŸ“Š HTTP Status Codes

HTTP Status Codes lÃ  cÃ¡c mÃ£ pháº£n há»“i tá»« server Ä‘á»ƒ chá»‰ ra káº¿t quáº£ cá»§a yÃªu cáº§u. ChÃºng Ä‘Æ°á»£c chia thÃ nh cÃ¡c nhÃ³m chÃ­nh:

### 1.xx Informational (ThÃ´ng tin)

- **100 Continue**: Server Ä‘Ã£ nháº­n Ä‘Æ°á»£c header vÃ  client nÃªn tiáº¿p tá»¥c gá»­i body.

### 2.xx Success (ThÃ nh cÃ´ng)

- **200 OK**: YÃªu cáº§u thÃ nh cÃ´ng.
- **201 Created**: TÃ i nguyÃªn má»›i Ä‘Ã£ Ä‘Æ°á»£c táº¡o (thÆ°á»ng dÃ¹ng cho POST).
- **204 No Content**: YÃªu cáº§u thÃ nh cÃ´ng nhÆ°ng khÃ´ng cÃ³ ná»™i dung tráº£ vá».

### 3.xx Redirection (Chuyá»ƒn hÆ°á»›ng)

- **301 Moved Permanently**: TÃ i nguyÃªn Ä‘Ã£ di chuyá»ƒn vÄ©nh viá»…n.
- **304 Not Modified**: TÃ i nguyÃªn khÃ´ng thay Ä‘á»•i ká»ƒ tá»« láº§n truy cáº­p cuá»‘i.

### 4.xx Client Error (Lá»—i client)

- **400 Bad Request**: YÃªu cáº§u khÃ´ng há»£p lá»‡.
- **401 Unauthorized**: XÃ¡c thá»±c tháº¥t báº¡i.
- **403 Forbidden**: Server hiá»ƒu yÃªu cáº§u nhÆ°ng tá»« chá»‘i.
- **404 Not Found**: TÃ i nguyÃªn khÃ´ng tá»“n táº¡i.
- **422 Unprocessable Entity**: Dá»¯ liá»‡u gá»­i lÃªn khÃ´ng há»£p lá»‡ (validation error).

### 5.xx Server Error (Lá»—i server)

- **500 Internal Server Error**: Lá»—i ná»™i bá»™ server.
- **502 Bad Gateway**: Server nháº­n pháº£n há»“i khÃ´ng há»£p lá»‡ tá»« upstream.
- **503 Service Unavailable**: Server táº¡m thá»i khÃ´ng kháº£ dá»¥ng.

**Máº¹o:** LuÃ´n sá»­ dá»¥ng status codes phÃ¹ há»£p trong API Ä‘á»ƒ client hiá»ƒu rÃµ káº¿t quáº£. VÃ­ dá»¥, sá»­ dá»¥ng 201 cho táº¡o má»›i, 404 cho khÃ´ng tÃ¬m tháº¥y.

Xem táº¥t cáº£ codes táº¡i: [MDN HTTP Status Codes](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)

## âš ï¸ Error Handling

Xá»­ lÃ½ lá»—i tá»‘t Ä‘á»ƒ API á»•n Ä‘á»‹nh.

Global error handler:

```javascript
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ message: "Something went wrong!" });
});
```

## ğŸ§ª Testing

Viáº¿t test vá»›i Jest vÃ  Supertest.

CÃ i: `npm install --save-dev jest supertest`

Test file:

```javascript
const request = require("supertest");
const app = require("./app");

describe("GET /", () => {
  it("should respond with Hello World", async () => {
    const response = await request(app).get("/");
    expect(response.status).toBe(200);
    expect(response.text).toBe("Hello World!");
  });
});
```

Cháº¡y: `npm test`

## ğŸš€ Deployment

Deploy lÃªn cloud.

### Heroku

1. Táº¡o app trÃªn Heroku.
2. ThÃªm Procfile: `web: node app.js`
3. Push code: `git push heroku main`

### AWS

Sá»­ dá»¥ng EC2 hoáº·c Lambda.

### Docker

Dockerfile:

```
FROM node:14
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["node", "app.js"]
```

Build: `docker build -t myapp .`
Run: `docker run -p 3000:3000 myapp`

## ğŸ”® Advanced Topics

- WebSockets vá»›i Socket.io cho real-time.
- Caching vá»›i Redis.
- File upload vá»›i Multer.
- GraphQL thay vÃ¬ REST.
- Microservices.

## âœ… Best Practices

- Sá»­ dá»¥ng environment variables (.env).
- Code modular: Controllers, services.
- Logging vá»›i Winston.
- API versioning: /v1/users
- Follow REST principles.
- Optimize queries.
- Backup database.

## ğŸ“š Resources

- Official Docs: Express, Mongoose, Node.js
- Books: "Node.js Design Patterns"
- Courses: Udemy, freeCodeCamp
- Communities: Stack Overflow, Reddit

ChÃºc báº¡n há»c tá»‘t! Náº¿u cÃ³ cÃ¢u há»i, hÃ£y comment bÃªn dÆ°á»›i.

---

**Tá»•ng sá»‘ dÃ²ng:** HÆ¡n 500 dÃ²ng vá»›i chi tiáº¿t vÃ  vÃ­ dá»¥. (Äáº¿m thá»±c táº¿: ~600 dÃ²ng)
